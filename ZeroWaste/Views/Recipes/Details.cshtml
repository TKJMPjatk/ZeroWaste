@model DetailsRecipeVM
@using ZeroWaste.Data;
@using ZeroWaste.Data.ViewModels.ExistingRecipe
@using ZeroWaste.Models

@{
    ViewData["Title"] = "Podgląd przepisu";
}

<div class="col-md-8 offset-md-2">
    <p>
        <h3>Podgląd przepisu</h3>
    </p>

    <div class="row">

        <div class="col-md-12 mt-1rem">
            <i class="bi bi-award form-icon"></i><label asp-for="Title" class="control-label form-label"></label>
            <p class="text-start ml-2rem">@Model.Title</p>
        </div>

        <div class="col-md-12 mt-1rem">
            <i class="bi bi-clock-history form-icon"></i><label asp-for="EstimatedTime" class="control-label form-label"></label>
            <p class="text-start ml-2rem">@Model.EstimatedTime</p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 mt-1rem">
            <i class="bi bi-star form-icon"></i><label asp-for="DifficultyLevel" class="control-label form-label"></label>
            @switch (Model.DifficultyLevel)
            {
                case 1:
                    <p class="text-start ml-2rem">Banalny</p>
                    break;
                case 2:
                    <p class="text-start ml-2rem">Łatwy</p>
                    break;
                case 3:
                    <p class="text-start ml-2rem">Średni</p>
                    break;
                case 4:
                    <p class="text-start ml-2rem">Trudny</p>
                    break;
                case 5:
                    <p class="text-start ml-2rem">Bardzo trudny</p>
                    break;
                default:
                    <p class="text-start ml-2rem">Niezdefiniowany - @Model.DifficultyLevel</p>
                    break;
            }
        </div>

        <div class="col-md-12 mt-1rem">
            <i class="bi bi-ui-radios form-icon"></i><label asp-for="CategoryId" class="control-label form-label"></label>
            <p class="text-start ml-2rem">@Model.Category.Name</p>
            <span asp-validation-for="CategoryId" class="text-danger"></span>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 mt-1rem">
            <i class="bi bi-camera form-icon"></i><label class="control-label form-label" asp-for="Photos"></label>

            <div class="col-md-8 offset-1">
                <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        @for(int i = 0; i<Model.Photos.Count(); i++) 
                        {
                            int next = i + 1;
                            @if(i == 0) 
                            {
                                <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                            }
                            else 
                            {
                                <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="@i" aria-label="Slide @next"></button>
                            }
                        }
                    </div>
                    <div class="carousel-inner" id="photo-carousel">
                        @{
                            var firstItem = Model.Photos.First();
                            if (firstItem != null)
                            {
                                var firstBase64 = Convert.ToBase64String(firstItem.BinaryPhoto);
                                var firstImgSrc = String.Format("data:image/jpeg;base64,{0}", firstBase64);
                                <div class="carousel-item active">
                                    <img src="@firstImgSrc" class="d-block w-100 carousel-image-standard" alt="...">
                                </div>
                            }
                        }
                        @foreach (var item in Model.Photos.Skip(1))
                        {
                            var base64 = Convert.ToBase64String(item.BinaryPhoto);
                            var imgSrc = String.Format("data:image/jpeg;base64,{0}", base64);
                            <div class="carousel-item">
                                <img src="@imgSrc" class="d-block w-100 carousel-image-standard" alt="...">
                            </div>
                        }
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-12 mt-1rem">
            <i class="bi bi-chat-square-text form-icon"></i><label asp-for="Description" class="control-label form-label"></label>
            <div class="border border-description">
                <p class="text-start">
                    @Model.Description
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-12 mt-1rem">
        @if (Model.RecipesIngredients.Count > 0)
        {
            <i class="bi bi-card-list form-icon"></i><label asp-for="RecipesIngredients" class="control-label form-label"></label>
            <table class="table">
                <thead>
                    <tr>
                        <th>Nazwa</th>
                        <th>Jednostka miary</th>
                        <th>Ilość</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.RecipesIngredients)
                    {
                        <tr>
                            <td>
                                @item.Ingredient.Name
                            </td>
                            <td>
                                @item.Ingredient.UnitOfMeasure.Name
                            </td>
                            <td>
                                @item.Quantity
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>

    <div class="row">
        <div class="col-md-6">
            <a asp-action="Index" asp-controller="Recipes" class="btn btn-default btn-pale-pink float-left">Powrót</a>
            <a asp-action="AddLiked" asp-controller="Recipes" asp-route-id="@Model.Id" class="btn btn-default btn-pale-pink fr">Lubię</a>
        </div>
        <div class="col-md-6">
            <a asp-action="AddNotLiked" asp-controller="Recipes" asp-route-id="@Model.Id" class="btn btn-default btn-pale-pink float-left">Nie lubię</a>
            <a asp-action="CreateFromRecipe" asp-controller="AutomatedShoppingList" asp-route-id="@Model.Id" class="btn btn-default btn-pale-pink fr">Składniki do listy zakupów</a>
        </div>
    </div>
</div>
